<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009"
		 xmlns:s="library://ns.adobe.com/flex/spark"
		 xmlns:mx="library://ns.adobe.com/flex/mx"
		 width="100%" height="100%" creationComplete="creationComplete(event)" fontFamily="Calibri"
		 fontSize="16">
	
	<fx:Script>
		<![CDATA[
			import flash.sampler.getInvocationCount;
			
			import il.co.topq.systems.report.events.user.GetUsersEvent;
			import il.co.topq.systems.report.models.ReportModelLocator;
			import il.co.topq.systems.report.models.valueobjects.User;
			import il.co.topq.systems.report.xml_utils.UserXMLConverter;
			
			import mx.collections.ArrayCollection;
			import mx.events.FlexEvent;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.events.ResultEvent;
			[Bindable]
			private var users:ArrayCollection = new ArrayCollection();
			private var currentUser:User = ReportModelLocator.getInstance().user;
			protected function getUsersCallbackResult(data:ResultEvent): void
			{
				var evt:ResultEvent = data as ResultEvent;
				var xmlList:XMLList = (new XML(evt.message.body)).users;
				users = UserXMLConverter.fromXMLList(xmlList); 
				

			}
			protected function getUsersCallbackFault(info:Object): void
			{
				var model:ReportModelLocator = ReportModelLocator.getInstance();
				var event:FaultEvent = FaultEvent(info);
				model.error.setMessage(event);
				model.applicationState.currentState = "ErrorPage";
			}
			
			protected function creationComplete(event:FlexEvent):void
			{
				new GetUsersEvent(getUsersCallbackResult, getUsersCallbackFault).dispatch();
			}
			
		]]>
	</fx:Script>
	
	
	<s:VGroup width="100%" height="100%" horizontalAlign="center" paddingTop="20"
			  verticalAlign="middle">
		<s:HGroup width="95%" horizontalAlign="left">
			<s:Label fontSize="16" fontWeight="bold" text="Existing Users"/>
		</s:HGroup>
		<mx:DataGrid width="95%" height="80%" dataProvider="{users}">
		<!--	<mx:ArrayCollection>
				<fx:Object>
					<fx:username>admin</fx:username>
					<fx:name>admin</fx:name>
					<fx:type>administrator</fx:type>
					<fx:status>enabled</fx:status>
				</fx:Object>
				<fx:Object>
					<fx:username>michael</fx:username>
					<fx:name>Michael Oziransky</fx:name>
					<fx:type>viewer</fx:type>
					<fx:status>enabled</fx:status>
				</fx:Object>
				<fx:Object>
					<fx:username>Itai</fx:username>
					<fx:name>Itai Agmon</fx:name>
					<fx:type>viewer</fx:type>
					<fx:status>disabled</fx:status>
				</fx:Object>
			</mx:ArrayCollection>-->
			<mx:columns>
				<mx:DataGridColumn dataField="firstName" headerText="First Name">
					<mx:headerRenderer>
						<fx:Component>				   			
							<mx:Label textAlign="center"/>
						</fx:Component>
					</mx:headerRenderer>	
				</mx:DataGridColumn>
				<mx:DataGridColumn dataField="lastName" headerText="Last Name">
					<mx:headerRenderer>
						<fx:Component>				   			
							<mx:Label textAlign="center"/>
						</fx:Component>
					</mx:headerRenderer>	
				</mx:DataGridColumn>
				<mx:DataGridColumn dataField="permissions" headerText="Permissions">
					<mx:headerRenderer>
						<fx:Component>				   			
							<mx:Label textAlign="center"/>
						</fx:Component>
					</mx:headerRenderer>	
				</mx:DataGridColumn>
			<!--	<mx:DataGridColumn dataField="status" headerText="Status">
					<mx:headerRenderer>
						<fx:Component>				   			
							<mx:Label textAlign="center"/>
						</fx:Component>
					</mx:headerRenderer>	
				</mx:DataGridColumn>-->
				<mx:DataGridColumn dataField="action" headerText="Action">
					<mx:headerRenderer>
						<fx:Component>				   			
							<mx:Label textAlign="center"/>
						</fx:Component>
					</mx:headerRenderer>	
					<mx:itemRenderer>
						<fx:Component>
							<mx:HBox width="100%" horizontalAlign="center" verticalAlign="middle">
								<fx:Script>
									<![CDATA[
										import il.co.topq.systems.report.models.ReportModelLocator;
										import il.co.topq.systems.report.models.valueobjects.User;
										
										private var currentUser:User = ReportModelLocator.getInstance().user;
									]]>
								</fx:Script>
								<mx:LinkButton enabled="{currentUser.permissions.search('User Manager') != -1}" label="Edit" rollOverColor="#2E44C7"
											   textRollOverColor="#ffffff"/>
								<s:Label text="|"/>
								<mx:LinkButton enabled="{currentUser.permissions.search('User Manager') != -1}" label="Delete" rollOverColor="#2E44C7"
											   textRollOverColor="#ffffff"/>
							</mx:HBox>
						</fx:Component>
					</mx:itemRenderer>
				</mx:DataGridColumn>
			</mx:columns>
		</mx:DataGrid>
		<s:HGroup width="95%" horizontalAlign="right" paddingBottom="20" paddingTop="20"
				  verticalAlign="bottom">
			<!--<s:Button label="getUser" chromeColor="#0A1E39" color="#FFFFFF" focusColor="#85AED4"
					  fontWeight="bold"/>-->
			<s:Button label="New User" visible = "{currentUser.permissions.search('User Manager') != -1}" chromeColor="#0A1E39" color="#FFFFFF" focusColor="#85AED4"
					  fontWeight="bold"/>
		</s:HGroup>
	</s:VGroup>
</s:Group>
